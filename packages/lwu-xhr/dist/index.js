'use strict';

var w=Object.defineProperty,g=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;var y=(i,t,e)=>t in i?w(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,b=(i,t)=>{for(var e in t||(t={}))P.call(t,e)&&y(i,e,t[e]);if(q)for(var e of q(t))f.call(t,e)&&y(i,e,t[e]);return i},x=(i,t)=>g(i,I(t));var n=(i,t,e)=>new Promise((r,s)=>{var u=h=>{try{l(e.next(h));}catch(c){s(c);}},o=h=>{try{l(e.throw(h));}catch(c){s(c);}},l=h=>h.done?r(h.value):Promise.resolve(h.value).then(u,o);l((e=e.apply(i,t)).next());});var H=class{constructor(t){this.errorHandler=e=>{},this.requestLib=t;}get(t,e){return n(this,null,function*(){return yield this.requestLib.get(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r))})}post(t,e){return n(this,null,function*(){return yield this.requestLib.post(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r))})}put(t,e){return n(this,null,function*(){return this.requestLib.put?yield this.requestLib.put(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r)):Promise.reject("put method is not supported")})}delete(t,e){return n(this,null,function*(){return this.requestLib.delete?yield this.requestLib.delete(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r)):Promise.reject("delete method is not supported")})}head(t,e){return n(this,null,function*(){return this.requestLib.head?yield this.requestLib.head(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r)):Promise.reject("head method is not supported")})}options(t,e){return n(this,null,function*(){return this.requestLib.options?yield this.requestLib.options(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r)):Promise.reject("options method is not supported")})}patch(t,e){return n(this,null,function*(){return this.requestLib.patch?yield this.requestLib.patch(t,e).then(r=>r,r=>(this.errorHandler&&this.errorHandler(r),r)):Promise.reject("patch method is not supported")})}request(t){return n(this,null,function*(){return this.requestLib.request?yield this.requestLib.request(t).then(e=>e,e=>(this.errorHandler&&this.errorHandler(e),e)):Promise.reject("request method is not supported")})}setErrorHandler(t){this.errorHandler=t;}setHeaders(t){if(!this.requestLib.setHeaders)throw new Error("setHeaders method is not supported");return this.requestLib.setHeaders(t),this}setHeader(t,e){if(!this.requestLib.setHeader)throw new Error("setHeader method is not supported");return this.requestLib.setHeader(t,e),this}setTimeout(t){if(!this.requestLib.setTimeout)throw new Error("setTimeout method is not supported");return this.requestLib.setTimeout(t),this}};var a=class{constructor(t){this._timeout=0;this._url="";this._config={url:"",method:"GET",headers:{},timeout:0,data:{},responseType:"json",baseURL:"",withCredentials:!1,dataType:"json",responseEncoding:"utf8",params:{}};this.requestLib=t,this.requestInterceptor=e=>e,this.responseInterceptor=e=>e,this.timeoutHandler=e=>{};}mergeConfig(t,e){let r=b(x(b({},this._config),{url:t}),e);return r.baseURL&&(r.url=r.baseURL+r.url),r}get(t,e){return n(this,null,function*(){var s;e=this.mergeConfig(t,e),e=this.requestInterceptor(e),this.requestLib.getXHRInstance&&(this.requestLib.getXHRInstance().ontimeout=()=>{this.timeoutHandler&&this.timeoutHandler(t);});let r=yield this.requestLib.get((s=e==null?void 0:e.url)!=null?s:"",e);return this._config=this.mergeConfig(t),this.responseInterceptor(r)})}post(t,e){return n(this,null,function*(){var s;e=this.mergeConfig(t,e),e=this.requestInterceptor(e);let r=yield this.requestLib.post((s=e==null?void 0:e.url)!=null?s:"",e);return console.log(r,"response"),this.responseInterceptor(r)})}put(t,e){return n(this,null,function*(){var s;if(e=this.mergeConfig(t,e),e=this.requestInterceptor(e),!this.requestLib.put)return Promise.reject("put method is not supported");let r=yield this.requestLib.put((s=e==null?void 0:e.url)!=null?s:"",e);return this.responseInterceptor(r)})}delete(t,e){return n(this,null,function*(){var s;if(e=this.mergeConfig(t,e),e=this.requestInterceptor(e),!this.requestLib.delete)return Promise.reject("delete method is not supported");let r=yield this.requestLib.delete((s=e==null?void 0:e.url)!=null?s:"",e);return this.responseInterceptor(r)})}head(t){return n(this,null,function*(){var s;let e=this.mergeConfig(t);if(e=this.requestInterceptor({url:t}),!this.requestLib.head)return Promise.reject("head method is not supported");let r=yield this.requestLib.head((s=e.url)!=null?s:"",e);return this.responseInterceptor(r)})}options(t){return n(this,null,function*(){var s;let e=this.mergeConfig(t);if(e=this.requestInterceptor({url:t}),!this.requestLib.options)return Promise.reject("options method is not supported");let r=yield this.requestLib.options((s=e.url)!=null?s:"",e);return this.responseInterceptor(r)})}patch(t,e){return n(this,null,function*(){var s;if(e=this.mergeConfig(t,e),e=this.requestInterceptor(e),!this.requestLib.patch)return Promise.reject("patch method is not supported");let r=yield this.requestLib.patch((s=e==null?void 0:e.url)!=null?s:"",e);return this.responseInterceptor(r)})}request(t){return n(this,null,function*(){var r;if(t=this.mergeConfig((r=t.url)!=null?r:"",t),t=this.requestInterceptor(t),!this.requestLib.request)return Promise.reject("request method is not supported");let e=yield this.requestLib.request(t);return this.responseInterceptor(e)})}setHeaders(t){if(!this.requestLib.setHeaders)throw new Error("setHeaders method is not supported");return this.requestLib.setHeaders(t),this}setHeader(t,e){if(!this.requestLib.setHeader)throw new Error("setHeader method is not supported");return this.requestLib.setHeader(t,e),this}setTimeout(t){if(!this.requestLib.setTimeout)throw new Error("setTimeout method is not supported");return this.requestLib.setTimeout&&this.requestLib.setTimeout(t),this}setRequestInterceptor(t){return this.requestInterceptor=t,this}setResponseInterceptor(t){return this.responseInterceptor=t,this}timeout(t,e){return this._config.timeout=t,this.timeoutHandler=e,this}setConfig(t){return this._config=t,this}getConfig(){return this._config}};var R=class{constructor(t){this._timeout=0;this.timeoutHandler=e=>{},this.requestLib=t,this._timeout=0;}get(t,e){return n(this,null,function*(){this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.get(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}post(t,e){return n(this,null,function*(){this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.post(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}put(t,e){return n(this,null,function*(){if(!this.requestLib.put)return Promise.reject("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 put \u8BF7\u6C42");this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.put(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}delete(t,e){return n(this,null,function*(){if(!this.requestLib.delete)return Promise.reject("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 delete \u8BF7\u6C42");this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.delete(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}head(t,e){return n(this,null,function*(){if(!this.requestLib.head)return Promise.reject("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 head \u8BF7\u6C42");this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.head(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}options(t,e){return n(this,null,function*(){if(!this.requestLib.options)return Promise.reject("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 options \u8BF7\u6C42");this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.options(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}request(t){return n(this,null,function*(){if(!this.requestLib.request)return Promise.reject("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 request \u8BF7\u6C42");this.timeoutHandler=()=>{var r;return this.timeoutHandler&&this.timeoutHandler((r=t.url)!=null?r:""),`Timeout of ${this._timeout} ms exceeded`};let e=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.request(t).then(r=>(clearTimeout(e),r),r=>(clearTimeout(e),r));})}patch(t,e){return n(this,null,function*(){if(!this.requestLib.patch)return Promise.reject("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 patch \u8BF7\u6C42");this.timeoutHandler=()=>(this.timeoutHandler&&this.timeoutHandler(t),`Timeout of ${this._timeout} ms exceeded`);let r=setTimeout(this.timeoutHandler,this._timeout);yield this.requestLib.patch(t,e).then(s=>(clearTimeout(r),s),s=>(clearTimeout(r),s));})}setHeaders(t){if(!this.requestLib.setHeaders)throw new Error("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 setHeaders \u65B9\u6CD5");return this.requestLib.setHeaders(t),this}setHeader(t,e){if(!this.requestLib.setHeader)throw new Error("\u5F53\u524D\u8FD0\u884C\u73AF\u5883\u4E0D\u652F\u6301 setHeader \u65B9\u6CD5");return this.requestLib.setHeader(t,e),this}timeout(t,e){return this._timeout=t,this.timeoutHandler=e,this}};var T=i=>Object.keys(i).map(r=>`${r}=${i[r]}`).join("&");var L=i=>Object.keys(i).length===0,p=class{constructor(){this.subscribers={};}subscribe(t,e){this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(e);}unsuscribe(t,e){this.subscribers[t]&&(this.subscribers[t]=this.subscribers[t].filter(r=>r!==e));}publish(t,e){this.subscribers[t]&&this.subscribers[t].forEach(r=>r(e));}};var m=class{constructor(t){this.requestQueue=[];this.currentRequest=null;this.pubSub=new p;this.xhr=t,this.timeout=0,this.headers={};}processQueue(){var t;this.currentRequest===null&&this.requestQueue.length>0&&(this.currentRequest=this.requestQueue.shift(),(t=this.currentRequest)==null||t.xhr.send(),this.currentRequest.xhr.onreadystatechange=()=>{var e,r,s,u,o;((e=this.currentRequest)==null?void 0:e.xhr.readyState)===4&&((r=this.currentRequest)==null?void 0:r.xhr.status)>=200&&((s=this.currentRequest)==null?void 0:s.xhr.status)<300&&(console.log("response",(u=this.currentRequest)==null?void 0:u.xhr.responseText),this.pubSub.publish("response",(o=this.currentRequest)==null?void 0:o.xhr.responseText)),this.currentRequest=null,this.processQueue();},this.currentRequest.xhr.onerror=()=>{var e;console.warn("An error occurred while sending the request."),this.pubSub.publish("error",(e=this.currentRequest)==null?void 0:e.xhr.statusText),this.currentRequest=null,this.processQueue();});}addRequestToQueue(t,e="GET",r){var u;let s=new XMLHttpRequest;["GET","HEAD","OPTIONS"].includes(e)&&r!=null&&r.params&&L(r.params)===!1&&(t+=`?${T(r.params)}`),s.open(e,t,!0),this._setHeaders(s,r==null?void 0:r.headers),s.timeout=(u=r==null?void 0:r.timeout)!=null?u:this.timeout,this.requestQueue.push({xhr:s,config:r}),this.processQueue();}get(t,e){return new Promise((r,s)=>{this.addRequestToQueue(t,"GET",e),this.pubSub.subscribe("response",u=>{(e==null?void 0:e.dataType)==="json"&&(u=JSON.parse(u)),r(u);}),this.pubSub.subscribe("error",u=>{s(u);});})}post(t,e){return new Promise((r,s)=>{var u;this.xhr.open("POST",t,!0),this._setHeaders(),this.xhr.timeout=(u=e==null?void 0:e.timeout)!=null?u:this.timeout,this.xhr.onreadystatechange=()=>{this.xhr.readyState===4&&(this.xhr.status>=200&&this.xhr.status<300?r(this.xhr.responseText):s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`)));},this.xhr.onerror=()=>{s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`));},e!=null&&e.data?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(e.data))):this.xhr.send();})}put(t,e){return new Promise((r,s)=>{var u;this.xhr.open("PUT",t,!0),this._setHeaders(),this.xhr.timeout=(u=e==null?void 0:e.timeout)!=null?u:this.timeout,this.xhr.onreadystatechange=()=>{this.xhr.readyState===4&&(this.xhr.status>=200&&this.xhr.status<300?r(this.xhr.responseText):s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`)));},this.xhr.onerror=()=>{s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`));},e!=null&&e.data?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(e.data))):this.xhr.send();})}delete(t,e){return new Promise((r,s)=>{var u;this.xhr.open("DELETE",t,!0),this._setHeaders(),this.xhr.timeout=(u=e==null?void 0:e.timeout)!=null?u:this.timeout,this.xhr.onreadystatechange=()=>{this.xhr.readyState===4&&(this.xhr.status>=200&&this.xhr.status<300?r(this.xhr.responseText):s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`)));},this.xhr.onerror=()=>{s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`));},this.xhr.send();})}head(t){return new Promise((e,r)=>{this.xhr.open("HEAD",t,!0),this.xhr.responseType="json",this.xhr.onload=()=>{this.xhr.status===200?e(this.xhr.response):r(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.status}`));},this.xhr.onerror=()=>{r(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.status}`));},this.xhr.send();})}options(t){return new Promise((e,r)=>{this.xhr.open("OPTIONS",t,!0),this.xhr.responseType="json",this.xhr.onload=()=>{this.xhr.status===200?e(this.xhr.response):r(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.status}`));},this.xhr.onerror=()=>{r(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.status}`));},this.xhr.send();})}patch(t,e){return new Promise((r,s)=>{var u;this.xhr.open("PATCH",t,!0),this._setHeaders(),this.xhr.timeout=(u=e==null?void 0:e.timeout)!=null?u:this.timeout,this.xhr.onreadystatechange=()=>{this.xhr.readyState===4&&(this.xhr.status>=200&&this.xhr.status<300?r(this.xhr.responseText):s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`)));},this.xhr.onerror=()=>{s(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`));},e!=null&&e.data?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(e.data))):this.xhr.send();})}request(t){return new Promise((e,r)=>{var s,u,o;this.xhr.open((s=t.method)!=null?s:"GET",(u=t.url)!=null?u:"",!0),this._setHeaders(),this.xhr.timeout=(o=t.timeout)!=null?o:this.timeout,this.xhr.onreadystatechange=()=>{this.xhr.readyState===4&&(this.xhr.status>=200&&this.xhr.status<300?e(this.xhr.responseText):r(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`)));},this.xhr.onerror=()=>{r(new Error(`\u8BF7\u6C42\u5931\u8D25\uFF1A${this.xhr.statusText}`));},t.data?(this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(JSON.stringify(t.data))):this.xhr.send();})}setHeader(t,e){return this.headers[t]=e,this}setTimeout(t){return this.timeout=t,this}setHeaders(t){return this.headers=t,this}getXHRInstance(){return this.xhr}_setHeaders(t,e){Object.entries(e).forEach(([r,s])=>{t&&t.setRequestHeader(r,s);});}};var d=class i{constructor(){this.xhr=new XMLHttpRequest;}static getInstance(){return i.instance||(i.instance=new i),i.instance}getXHR(){return this.xhr}};function K(i){let t=d.getInstance().getXHR(),e=new m(t);return i&&i.useInterceptor?(console.log("\u62E6\u622A\u5668\u88C5\u9970\u5668"),new a(e)):e}

exports.ErrorHandlerDecorator = H;
exports.InterceptorDecorator = a;
exports.RequestLibraryImpl = m;
exports.Singleton = d;
exports.TimeoutDecorator = R;
exports.create = K;
