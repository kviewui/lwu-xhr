'use strict';

var m=Object.defineProperty;var l=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var c=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,s=(r,e)=>{for(var t in e||(e={}))x.call(e,t)&&c(r,t,e[t]);if(l)for(var t of l(e))R.call(e,t)&&c(r,t,e[t]);return r};var d=r=>Object.keys(r).map(i=>`${i}=${r[i]}`).join("&");var a=class{constructor(){this.interceptors={request:{use:(e,t,i)=>{this.reqConfig=s(s({},this.reqConfig),e(this.reqConfig)),console.log(this.reqConfig,this.xhr,"\u62E6\u622A\u540E\u7684\u914D\u7F6E"),this.requestError(t);}},response:{use:e=>{}}};this.response=null;this.error=null;this.success=!1;this.xhr=null;this.defaults={baseURL:"",timeout:0,headers:{},method:"GET",withCredentials:!1,responseType:"",responseEncoding:"",xsrfCookieName:"",xsrfHeaderName:"",maxContentLength:0,maxBodyLength:0,dataType:"json"};this.defaultsReqConfig=s({data:{}},this.defaults);this.reqConfig=s({data:{}},this.defaults);}beforeRequest(e){this.reqConfig=e(this.reqConfig);}requestError(e){e(this.xhr);}responseCall(e){this.response=e(this.response);}responseError(e){e(this.error);}buildSendData(e){return e==="GET"?"":JSON.stringify(this.reqConfig.data)}afterRequest(){this.reqConfig=this.defaultsReqConfig,this.xhr=null;}commonRequest(e,t="GET"){var u,f,g;console.log(this.reqConfig,"\u8BF7\u6C42\u914D\u7F6E"),this.xhr=new XMLHttpRequest;let i=this.xhr;if(this.xhr&&(this.xhr.timeout=(u=this.reqConfig.timeout)!=null?u:0,this.xhr.withCredentials=(f=this.reqConfig.withCredentials)!=null?f:!1,this.xhr.responseType=(g=this.reqConfig.responseType)!=null?g:"",this.xhr.open(t,`${this.reqConfig.baseURL}${e}${this.reqConfig.params?`?${d(this.reqConfig.params)}`:""}`,!0),this.reqConfig.headers))for(let[h,o]of Object.entries(this.reqConfig.headers))this.xhr.setRequestHeader(h,o);return new Promise((h,o)=>{if(this.xhr){this.xhr.send(this.buildSendData(t)),this.xhr.ontimeout=()=>{this.afterRequest(),o({data:{},statusCode:408,statusText:"\u8BF7\u6C42\u8D85\u65F6",headers:{},request:this.xhr});},this.xhr.onerror=()=>{this.afterRequest(),o({data:{},statusCode:502,statusText:"\u8BF7\u6C42\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u5BA2\u6237\u7AEF\u7F51\u7EDC\u662F\u5426\u6B63\u5E38",headers:{},request:this.xhr});};let p=this.reqConfig;console.log(this.xhr,"\u8BF7\u6C42\u4E2D...."),this.xhr.onloadend=()=>{var n,C,q;console.log(i,"\u8BF7\u6C42\u7ED3\u675F\u4E86"),h({data:this.response,statusCode:(n=this.xhr)==null?void 0:n.status,statusText:(C=this.xhr)==null?void 0:C.statusText,headers:(q=this.xhr)==null?void 0:q.getResponseHeader,request:this.xhr}),this.afterRequest();},this.xhr.onload=()=>{console.log(i,"done"),console.log(i.response,"\u8BF7\u6C42\u5B8C\u6210\u4E86"),console.log(p,"\u8BF7\u6C42\u914D\u7F6E");let n=p.dataType==="json"?JSON.parse(i.response):i.response;this.response=n,this.interceptors.response.use&&this.response&&this.interceptors.response.use(this.response);};}})}get(e,t){return typeof t=="object"&&(this.reqConfig=s(s({},this.reqConfig),t)),this.commonRequest(e,"GET")}post(e,t){return this.reqConfig=s(s({},this.reqConfig),t),this.commonRequest(e,"POST")}put(e,t){return this.reqConfig=s(s({},this.reqConfig),t),this.commonRequest(e,"POST")}delete(e,t){return this.reqConfig=s(s({},this.reqConfig),t),this.commonRequest(e,"DELETE")}request(e){return this.reqConfig=s(s({},this.reqConfig),e),this.commonRequest(this.reqConfig.url,this.reqConfig.method)}head(e,t){return this.reqConfig=s(s({},this.reqConfig),t),this.commonRequest(e,"HEAD")}options(e,t){return this.reqConfig=s(s({},this.reqConfig),t),this.commonRequest(e,"OPTIONS")}patch(e,t){return this.reqConfig=s(s({},this.reqConfig),t),this.commonRequest(e,"PATCH")}abort(){var e;(e=this.xhr)==null||e.abort();}create(e){return this.reqConfig=s(s({},this.defaults),e),console.log(this.reqConfig,"\u5B9E\u4F8B\u914D\u7F6E"),this}setConfig(e){return this.reqConfig=s(s({},this.reqConfig),e),console.log(this.reqConfig,"\u8BBE\u7F6E\u8BF7\u6C42\u914D\u7F6E"),this}getConfig(){return this.reqConfig}getBaseURL(){return this.reqConfig.baseURL}setHeader(e){return this.reqConfig.headers=s(s({},this.reqConfig.headers),e),this}},H=new a;

exports.LwuXHR = H;
