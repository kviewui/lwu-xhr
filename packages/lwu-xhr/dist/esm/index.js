var d=Object.defineProperty;var q=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var p=(s,e,t)=>e in s?d(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,r=(s,e)=>{for(var t in e||(e={}))m.call(e,t)&&p(s,t,e[t]);if(q)for(var t of q(e))x.call(e,t)&&p(s,t,e[t]);return s};var l=s=>Object.keys(s).map(i=>`${i}=${s[i]}`).join("&");var h=class{constructor(){this.interceptors={request:{use:(e,t,i)=>{}},response:{use:(e,t,i)=>{}}};this.response=null;this.error=null;this.success=!1;this.xhr=null;this.defaults={baseURL:"",timeout:0,headers:{},method:"GET",withCredentials:!1,responseType:"",responseEncoding:"",xsrfCookieName:"",xsrfHeaderName:"",maxContentLength:0,maxBodyLength:0,dataType:"json",before:()=>{},after:()=>{}};this.defaultsReqConfig=r({data:{}},this.defaults);this.reqConfig=r({data:{}},this.defaults);}beforeRequest(e){this.reqConfig=e(this.reqConfig);}requestError(e){e(this.xhr);}responseCall(e){this.response=e(this.response);}responseError(e){e(this.error);}buildSendData(e){return e==="GET"?"":JSON.stringify(this.reqConfig.data)}afterRequest(){this.reqConfig=this.defaultsReqConfig;}createXHR(e="GET",t){let i=new XMLHttpRequest;return i.open(e,t,!0),i}commonRequest(e,t="GET"){var i,a,f;if(console.log(this.reqConfig,"\u8BF7\u6C42\u914D\u7F6E"),this.xhr=this.createXHR(t,`${this.reqConfig.baseURL}${e}${this.reqConfig.params?`?${l(this.reqConfig.params)}`:""}`),this.xhr&&(this.xhr.timeout=(i=this.reqConfig.timeout)!=null?i:0,this.xhr.responseType=(a=this.reqConfig.responseType)!=null?a:"",this.xhr.withCredentials=(f=this.reqConfig.withCredentials)!=null?f:!1,this.reqConfig.before&&(this.reqConfig=this.reqConfig.before(this.reqConfig)),this.reqConfig.headers))for(let[n,o]of Object.entries(this.reqConfig.headers))this.xhr.setRequestHeader(n,o);return new Promise((n,o)=>{if(this.xhr){this.xhr.send(this.buildSendData(t)),this.xhr.ontimeout=()=>{this.afterRequest(),o({data:{},statusCode:408,statusText:"\u8BF7\u6C42\u8D85\u65F6",headers:{},request:this.xhr});},this.xhr.onerror=()=>{this.afterRequest(),o({data:{},statusCode:502,statusText:"\u8BF7\u6C42\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u5BA2\u6237\u7AEF\u7F51\u7EDC\u662F\u5426\u6B63\u5E38",headers:{},request:this.xhr});};this.reqConfig;console.log(this.xhr,"\u8BF7\u6C42\u4E2D...."),this.xhr.onloadend=()=>{var u,g,C;console.log(this.response,"\u8BF7\u6C42\u7ED3\u675F\u4E86"),n({data:this.response,statusCode:(u=this.xhr)==null?void 0:u.status,statusText:(g=this.xhr)==null?void 0:g.statusText,headers:(C=this.xhr)==null?void 0:C.getResponseHeader,request:this.xhr}),this.afterRequest();};let c=this.xhr;this.xhr.onload=()=>{this.reqConfig.after&&(this.response=this.reqConfig.after(c.response));};}})}get(e,t){return typeof t=="object"&&(this.reqConfig=r(r({},this.reqConfig),t)),this.commonRequest(e,"GET")}post(e,t){return this.reqConfig=r(r({},this.reqConfig),t),this.commonRequest(e,"POST")}put(e,t){return this.reqConfig=r(r({},this.reqConfig),t),this.commonRequest(e,"POST")}delete(e,t){return this.reqConfig=r(r({},this.reqConfig),t),this.commonRequest(e,"DELETE")}request(e){return this.reqConfig=r(r({},this.reqConfig),e),this.commonRequest(this.reqConfig.url,this.reqConfig.method)}head(e,t){return this.reqConfig=r(r({},this.reqConfig),t),this.commonRequest(e,"HEAD")}options(e,t){return this.reqConfig=r(r({},this.reqConfig),t),this.commonRequest(e,"OPTIONS")}patch(e,t){return this.reqConfig=r(r({},this.reqConfig),t),this.commonRequest(e,"PATCH")}abort(){var e;(e=this.xhr)==null||e.abort();}create(e){return this.reqConfig=r(r({},this.defaults),e),console.log(this.reqConfig,"\u5B9E\u4F8B\u914D\u7F6E"),this}setConfig(e){return this.reqConfig=r(r({},this.reqConfig),e),console.log(this.reqConfig,"\u8BBE\u7F6E\u8BF7\u6C42\u914D\u7F6E"),this}getConfig(){return this.reqConfig}getBaseURL(){return this.reqConfig.baseURL}setHeader(e){return this.reqConfig.headers=r(r({},this.reqConfig.headers),e),this}},L=new h;

export { L as LwuXHR };
